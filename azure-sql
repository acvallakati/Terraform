trigger:
- none

pool:
  vmImage: 'ubuntu-latest'

stages:
- stage: Terraform_Install
  jobs:
  - job: Install
    steps:
    - task: JasonBJohnson.azure-pipelines-tasks-terraform.azure-pipelines-tasks-terraform-installer.TerraformInstaller@2
      displayName: Terraform Install
      inputs:
        terraformVersion: 'latest'
 
    - task: AzureCLI@2
      displayName: Authentication to Azure STA
      inputs:
        azureSubscription: 'test-fed-30-07'
        scriptType: 'bash'
        scriptLocation: 'inlineScript'
        inlineScript: 'echo authentication to azure'
    - task: TerraformCLI@2
      inputs:
        command: 'init'
        backendType: 'azurerm'
        backendServiceArm: 'test-fed-30-07'
        allowTelemetryCollection: true
    - task: TerraformTask@5
      displayName: Terraform Plan
      inputs:
        provider: 'azurerm'
        command: 'plan'
        environmentServiceNameAzureRM: 'test-fed-30-07'

    - task: TerraformTask@5
      displayName: Terraform Apply
      inputs:
        provider: 'azurerm'
        command: 'apply'
        environmentServiceNameAzureRM: 'test-fed-30-07'

    # - task: TerraformTask@5
    #   displayName: Terraform Destory
    #   inputs:
    #     provider: 'azurerm'
    #     command: 'destroy'
    #     environmentServiceNameAzureRM: 'test-fed-30-07'
